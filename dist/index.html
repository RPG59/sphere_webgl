<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<canvas width="1024" height="768" id="3D"></canvas>

<script type="x-shader/x-vertex" id="vs">#version 300 es
    layout(location=0) in vec3 a_position;
    layout(location=1) in vec3 a_normal;
    layout(location=2) in vec2 a_textureCoord;

    out vec3 FragPos;
    out vec3 Normal;
    out vec2 TexCoords;

    uniform mat4 u_viewMatrix;
    uniform mat4 u_projMatrix;
    uniform mat4 u_modelMatrix;

    void main() {
        gl_Position = u_projMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1.);
        FragPos = vec3(u_modelMatrix * vec4(a_position, 1.0));
        Normal = mat3(transpose(inverse(u_modelMatrix))) * a_normal;
        TexCoords = a_textureCoord;
    }
</script>
<script type="x-shader/x-fragment" id="fs">#version 300 es
    precision lowp float;
    struct Material {
        sampler2D diffuse;
        sampler2D specular;
        float shininess;
    };
    struct Light {
        vec3 position;
    
        vec3 ambient;
        vec3 diffuse;
        vec3 specular;

        float constant;
        float linear;
        float quadratic;
    };

    struct SpotLight {
        vec3 direction;
        float cutOff;
    };

    in vec3 Normal;
    in vec3 FragPos; // geometry coordinates in global space
    in vec2 TexCoords;


    out vec4 FragColor;

    uniform vec3 objectColor;
    uniform vec3 viewPos;
    uniform Material material;
    uniform Light light;
    uniform SpotLight spotlight;
    uniform samplerCube skybox;


    void main() {
        vec3 lightDir = normalize(light.position - FragPos);
        float theta = dot(lightDir, normalize(spotlight.direction));
//        float theta = dot(lightDir, -normalize(lightDir - vec3(1.75, .0, .0)));

//        if (theta > spotlight.cutOff) {
//            float distance = length(light.position - FragPos);
//            float attenuation = 1.0 / (light.constant + light.linear * distance + light.quadratic * distance * distance);
//
//           vec3 ambient = light.ambient * vec3(texture(material.diffuse, TexCoords));   
//
//            vec3 norm = normalize(Normal);
//            float diff = max(dot(norm, lightDir), 0.0);
//            vec3 diffuse = diff * light.diffuse * vec3(texture(material.diffuse, TexCoords));
//    
//            float specularStrength = .5;
//            vec3 viewDir = normalize(viewPos - FragPos);
//            vec3 reflectDir = reflect(-lightDir, norm);  
//            float spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);
//            vec3 specular = spec * light.specular * vec3(texture(material.specular, TexCoords)); 
//    
////            ambient *= attenuation;
//            diffuse *= attenuation;
//            specular *= attenuation;
//            
//            
//            vec3 result = (ambient + diffuse + specular) * objectColor;
//
//            FragColor = vec4(result, 1.);
//        } else {
//            FragColor = vec4(light.ambient * vec3(texture(material.diffuse, TexCoords)), 1.0)  * 4.;
//        }
        float ratio = 1. / 1.52;
        vec3 viewDir = normalize(FragPos - viewPos);
        vec3 reflectionVector = reflect(viewDir, normalize(Normal));
//        vec3 reflectionVector = refract(viewDir, normalize(Normal), ratio);
        FragColor = vec4(texture(skybox, reflectionVector).rgb, 1.0);
    }
</script>

<script type="x-shader/x-vertex" id="vs_lighting">#version 300 es
    layout(location=0) in vec4 a_position;

    uniform mat4 u_viewMatrix;
    uniform mat4 u_projMatrix;
    uniform mat4 u_modelMatrix;

    void main() {
        gl_Position = u_projMatrix * u_viewMatrix * u_modelMatrix * a_position;
    }
</script>

<script type="x-shader/x-fragment" id="fs_lighting">#version 300 es
    precision lowp float;
    out vec4 FragColor;

    void main() {
        FragColor = vec4(1.);
    }
</script>

<script type="x-shader/x-vertex" id="vs_skybox">#version 300 es
layout(location=3) in vec3 a_position;

out vec3 TexCoord;

uniform mat4 u_viewMatrix;
uniform mat4 u_projMatrix;
uniform mat4 u_modelMatrix;

void main() {
    gl_Position = vec4(u_projMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1.0)).xyww;
    TexCoord = a_position;
}
</script>

<script type="x-shader/x-fragment" id="fs_skybox">#version 300 es
precision lowp float;
in vec3 TexCoord;
out vec4 FragColor;

uniform samplerCube skybox;

void main() {
    FragColor = texture(skybox, TexCoord);
}
</script>



<script>
    gl = null;
    const canvas = document.getElementById('3D');

    try {
        gl = canvas.getContext('webgl2');
    } catch (e) {
        console.log('webGL2 is not ok!');
    }
</script>
<script src="./bundle.js"></script>
</body>


</html>
